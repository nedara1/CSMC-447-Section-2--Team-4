<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>4YP</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        /* Basic styling */
        body {
            min-height: 200vh;
            font-family: Arial, sans-serif;
            margin: 0;
            padding-top: 70px; /* Space for fixed navbar */
            background-color: #121212; /* Dark background */
            color: #f1c40f; /* Gold color */
            overflow-x: hidden;
            overflow-y: auto;
        }

        /* Navbar styling */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #1e1e1e;
            color: #f1c40f;
            padding: 10px 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .navbar__container { display: flex; align-items: center; justify-content: space-between; max-width:1200px; margin:0 auto; padding:0 20px; }
        .navbar__menu { display:flex; list-style:none; margin:0; padding:0; }
        .navbar__item { margin:0 15px; }
        .navbar__links { color:#f1c40f; text-decoration:none; font-size:16px; }
        .navbar__btn a { background-color:#f1c40f; color:black; padding:10px 20px; border-radius:5px; text-decoration:none; }
        .navbar__btn a:hover { background-color:#f39c12; }

        /* Split panels */
        .split { position: fixed; top: 70px; height: calc(100% - 70px); overflow: auto; }
        .left { left: 0; width: 35%; background-color: #1e1e1e; padding:20px; box-sizing:border-box; }
        .right { right: 0; width: 65%; background-color: #34495e; padding:20px; box-sizing:border-box; }

        /* Draggable items */
        .draggable { width:100px; height:30px; background-color:#f39c12; border:1px solid #000; margin:5px; text-align:center; line-height:30px; cursor:move; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2); color:black; }
        .draggable.active { outline:2px solid #4CAF50; }
        .draggable:hover { background-color:#d35400; }

        /* Boxes */
        .box { width:100px; min-height:100px; margin:20px; border:2px dashed #f1c40f; display:flex; flex-direction:column; align-items:center; padding:10px; background-color:#2c3e50; border-radius:10px; }
        .box-items { flex:1; display:flex; flex-wrap:wrap; justify-content:center; width:100%; }
        #box0 { display:flex; flex-wrap:wrap; justify-content:space-evenly; align-items:center; width:100%; height:145px; background-color:#2c3e50; border-radius:10px; padding:10px; }
        .box-container { display:flex; flex-wrap:wrap; gap:40px; margin-top:20px; }

        /* Controls */
        #searchCourseBox { margin:20px 0; display:flex; gap:10px; }
        #searchCourseBox input { flex:1; padding:10px; font-size:16px; border-radius:5px; border:1px solid #f1c40f; }
        #searchCourseBox button { padding:10px 20px; background-color:#f1c40f; color:black; border:none; border-radius:5px; cursor:pointer; }
        #searchCourseBox button:hover { background-color:#f39c12; }
        .compare-btn { margin-top:20px; }
        .compare-btn button { padding:10px 20px; background-color:#f1c40f; color:black; border:none; border-radius:5px; cursor:pointer; }
        .compare-btn button:hover { background-color:#f39c12; }
        .compare-result { margin-top:20px; font-size:16px; color:#f1c40f; font-weight:bold; }

        .left-header { font-family:Arial,sans-serif; color:#d8d5d5; margin-bottom:10px; }
        .left-text { font-family:Verdana,sans-serif; color:#b3b3b3; text-align:justify; }

        @media(max-width:768px){ .left, .right { width:100%; left:0; right:0; position:relative; top:70px; height:auto; } }
    </style>
</head>
<body>
<nav class="navbar">
    <div class="navbar__container">
        <img src="../shield.png" alt="Shield" width="60" height="60">
        <a href="#umbc" id="navbar__logo">UMBC</a>
        <ul class="navbar__menu">
            <li class="navbar__item"><a href="../index.html" class="navbar__links">Home</a></li>
            <li class="navbar__item"><a href="../about.html" class="navbar__links">About</a></li>
            <li class="navbar__item"><a href="../CMSC/cmsc_general.html" class="navbar__links">Computer Science</a></li>
            <li class="navbar__item"><a href="../CMPE/computer_engineering.html" class="navbar__links">Computer Engineering</a></li>
            <li class="navbar__item"><a href="../CHEME/chemical_engineering.html" class="navbar__links">Chemical Engineering</a></li>
            <li class="navbar__item"><a href="../MCE/mechanical_engineering.html" class="navbar__links">Mechanical Engineering</a></li>
            <li class="navbar__item"><a href="../IS/information_systems.html" class="navbar__links">Information Systems</a></li>
            <li class="navbar__item"><a href="../BUS/business_tech_admin.html" class="navbar__links">Business Tech Admin</a></li>
            <li class="navbar__btn"><a href="../CUSTOM/custom.html">Custom</a></li>
        </ul>
    </div>
</nav>

<div class="split left">
    <h2 class="left-header">4 Year Plan</h2>
    <p class="left-text">
        <br>
        This place is going to hold information about class.
        There will be drop down menu where  the user will be able to see classes.
        And all the impormation pretenting to it.
        Like there will be CMSC tab,where user can see all CMSC classes.
        We can keep going futher in details there
    </p>

</div>

<div class="split right">
    <h2 class="left-header">Course Entry</h2>
    <div id="searchCourseBox">
        <input type="text" id="courseSearchInput" placeholder="Enter Course ID (e.g., CMSC 101)">
        <button id="searchBtn">Add Course</button>
    </div>
    <p><b>Courses Entered:</b></p>
    <div class="box" id="box0"></div>

    <div class="box-container" id="container1">
        <div class="box" id="box1"><p><b>Sem 1</b></p><div class="box-items" id="box1Items"></div></div>
        <div class="box" id="box2"><p><b>Sem 2</b></p><div class="box-items" id="box2Items"></div></div>
        <div class="box" id="box3"><p><b>Sem 3</b></p><div class="box-items" id="box3Items"></div></div>
        <div class="box" id="box4"><p><b>Sem 4</b></p><div class="box-items" id="box4Items"></div></div>
    </div>
    <div class="box-container" id="container2">
        <div class="box" id="box5"><p><b>Sem 5</b></p><div class="box-items" id="box5Items"></div></div>
        <div class="box" id="box6"><p><b>Sem 6</b></p><div class="box-items" id="box6Items"></div></div>
        <div class="box" id="box7"><p><b>Sem 7</b></p><div class="box-items" id="box7Items"></div></div>
        <div class="box" id="box8"><p><b>Sem 8</b></p><div class="box-items" id="box8Items"></div></div>
        <div class="box" id="DelBox"><p><b>Delete Here</b></p><div class="box-items" id="DelBoxItems"></div></div>
    </div>

    <div class="compare-btn">
        <button id="compareAcrossBtn">Check Plan</button>
    </div>
    <div id="comparisonResult" class="compare-result"></div>
</div>

<script>
    let activeElement = null;

    // 1) Fetch & create a draggable course tile
    async function searchCourse() {
        const id = document.getElementById('courseSearchInput').value.trim();
        if (!id) return alert('Enter a Course ID');
        try {
            const res = await fetch(`http://localhost:8080/api/course/${encodeURIComponent(id)}`);
            if (!res.ok) {
                console.log(await res.text());
                return alert('Course not found');
            }
            const course = await res.json();
            createDraggableCourse(course);
        } catch (e) {
            console.error(e);
            alert('Error fetching course');
        }
    }

    // 2) Create a draggable element for a Course object
    function createDraggableCourse(course) {
        const el = document.createElement('div');
        el.className = 'draggable';
        el.textContent = course.courseId;
        el.dataset.course = JSON.stringify(course);
        el.id = `draggable-${course.courseId.replace(/\s+/g,'-')}-${Date.now()}`;
        el.draggable = true;
        el.addEventListener('dragstart', handleDragStart);
        el.addEventListener('click', () => setActiveElement(el));
        document.getElementById('box0').appendChild(el);
    }

    // 3) Drag start: stash the element’s ID
    function handleDragStart(e) {
        e.dataTransfer.setData('text/plain', e.target.id);
        e.dataTransfer.effectAllowed = 'move';
    }

    // Highlight selected
    function setActiveElement(el) {
        if (activeElement) activeElement.classList.remove('active');
        activeElement = el;
        el.classList.add('active');
    }

    // 4) Set up all boxes to allow dropping
    function initDragAndDrop() {
        document.querySelectorAll('.box').forEach(box => {
            box.addEventListener('dragover', e => { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; });
            box.addEventListener('drop', handleDrop);
        });
    }

    // 5) On drop, move or delete the dragged element
    function handleDrop(e) {
        e.preventDefault();
        const id = e.dataTransfer.getData('text/plain');
        const draggedEl = document.getElementById(id);
        if (!draggedEl) return;
        const box = e.currentTarget;
        if (box.id === 'DelBox') {
            draggedEl.remove();
            if (draggedEl === activeElement) activeElement = null;
            return;
        }
        const itemsContainer = box.querySelector('.box-items') || box;
        itemsContainer.appendChild(draggedEl);
    }

    // delete via button click
    function deleteElement(event) {
        event.stopPropagation();
        if (!activeElement) return alert('No course selected to delete.');
        activeElement.remove();
        activeElement = null;
    }

    // 0) Quick sanity check: did DataAlgo.js attach itself?
    console.log('🛠️ DataAlgo loaded?', 'checkCourseSequence=', typeof window.checkCourseSequence, 'checkPrerequisites=', typeof window.checkPrerequisites);

    // 2) The improved compareAcross()
    async function compareAcross() {
        console.log('🔔 compareAcross() clicked');
        const draggables = Array.from(document.querySelectorAll('.box-items .draggable'));
        const resultEl = document.getElementById('comparisonResult');
        if (draggables.length === 0) {
            resultEl.textContent = '⚠️ Please add courses before comparing.';
            return;
        }
        const plan = draggables.map(el => {
            const c = JSON.parse(el.dataset.course);
            return { name: c.courseId, prereq: (c.prerequisites||[]).map(code=>[code.trim()]) };
        });
        try {
            const res = await fetch('/api/compare', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({plan}) });
            const {valid,message} = await res.json();
            resultEl.textContent = valid ? 'Your 4 year plan is valid!' : `❌ ${message}`;
        } catch(err) {
            console.error('Error calling /api/compare:', err);
            resultEl.textContent = 'Error validating plan.';
        }
    }

    // 1) Wire up buttons once DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        initDragAndDrop();
        document.getElementById('searchBtn').addEventListener('click', searchCourse);
        document.getElementById('compareAcrossBtn').addEventListener('click', compareAcross);
        document.getElementById('DelBox').addEventListener('click', deleteElement);
    });
</script>

</body>
</html>
